% FUNCTION NAME:
%   Vulnerability_model
%
% DESCRIPTION:
%   This is basically the Vulnerability model, outputting the monetized values of the
%   space objects in conjunction as the socio-economic impact of the conjunction event in case of collision.
%
% INPUT:
%   Primary_eos = (1 object)  Primary NASA satellite in conjunction [NASA_sat]
%   Secondary_object = (1 object) Secondary space object in conjunction with the NASA satellite [Space_object]
%   m1 = [1x1] Mass of primary NASA satellite [kg]
%   Rel_v = [1x1] Normal of relative velocity between the two objects in conjunction at TCA [m/s] !
%   m2 = [1x1] Mass of the secondary object [kg]
%
% OUTPUT:
%   value1 = [1x1] Monetized value of the primary NASA satellite
%   value2 = [1x1] Monetized value of the secondary object
%   value_CC = [1x1] Monetized value of the collision consequence
%   NumOfPiece = [1x1] Number of released debris pieces in case of collision
%   cost_ofCDM = [1x1] operational cost for analyzing the cdm based on the Pc value [$]
%
% ASSUMPTIONS AND LIMITATIONS:
%   The values need to be normalized before summation.
%
% REVISION HISTORY:
%   Dates in DD/MM/YYYY
%
%   11/1/2023 - Sina Es haghi
%       * Adding header
%   30/1/2023 - Sina Es haghi
%       * Adding the collision consequence calculation to the vulnerability model
%   20/2/2024 - Sina Es haghi
%       * Modifying description and also explaining cost of CDM
%
function [value1,value2,value_CC,NumOfPieces,cost_ofCDM]= Vulnerability_model(Primary_eos,Secondary_object,m1,Rel_v,m2,Pc)
config = GetConfig;
if isempty(Primary_eos.value)
    %Primary_eos=Valuing_NASA_EOS(Primary_eos);
    Primary_eos=Ordinal_valuation_NASA(Primary_eos);
end
value1=Primary_eos.value;
if isempty(Secondary_object.value)
%    Secondary_object=Valuing_Secondary_obj(Secondary_object);
end
value2=Secondary_object.value; % for output

[~,NumOfPieces] = CollisionConsequenceNumPieces(m1,Rel_v,m2);
value_CC=NumOfPieces/config.CC_normalizer;

if nargout == 5 && nargin == 6
    if Pc < config.yellow_event_Pc
        cost_ofCDM = config.cdmCost_lowPc;
    elseif Pc < config.red_event_Pc
        cost_ofCDM = config.cdmCost_medPc;
    else
        cost_ofCDM = config.cdmCost_higPc;
    end
end
